[file name]: app.js
// –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ HealthFlow
class HealthFlowApp {
    constructor() {
        this.state = {
            currentPage: 'water',
            totalSkins: 0,
            theme: 'cozy'
        };
    }
    
    async init() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HealthFlow...');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        this.loadState();
        
        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        this.createPageContainer();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        await this.loadPage('water');
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        this.setupNavigation();
        
        console.log('‚úÖ HealthFlow –∑–∞–ø—É—â–µ–Ω');
    }
    
    loadState() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫–∏–Ω—Ç—ã
        const savedSkins = localStorage.getItem('healthflow_skins');
        this.state.totalSkins = savedSkins ? parseInt(savedSkins) : 0;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–º—É
        const savedTheme = localStorage.getItem('healthflow_theme');
        this.state.theme = savedTheme || 'cozy';
        document.documentElement.setAttribute('data-theme', this.state.theme);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        const savedPage = localStorage.getItem('healthflow_page');
        if (savedPage && ['water', 'workouts', 'profile'].includes(savedPage)) {
            this.state.currentPage = savedPage;
        }
    }
    
    saveState() {
        localStorage.setItem('healthflow_skins', this.state.totalSkins.toString());
        localStorage.setItem('healthflow_theme', this.state.theme);
        localStorage.setItem('healthflow_page', this.state.currentPage);
    }
    
    createPageContainer() {
        const container = document.getElementById('appContainer');
        container.innerHTML = `
            <div class="page active" id="currentPage">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        `;
    }
    
    async loadPage(pageId) {
        console.log(`üìÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${pageId}`);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        this.state.currentPage = pageId;
        this.saveState();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        this.updateNavigation(pageId);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        await this.loadPageContent(pageId);
    }
    
    async loadPageContent(pageId) {
        const container = document.getElementById('currentPage');
        
        try {
            if (pageId === 'water') {
                await this.loadWaterPage(container);
            } 
            else if (pageId === 'workouts') {
                await this.loadWorkoutsPage(container);
            } 
            else if (pageId === 'profile') {
                this.loadProfilePage(container);
            }
        } catch (error) {
            console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageId}:`, error);
            container.innerHTML = `<div class="error-message" style="padding: 40px; text-align: center;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</div>`;
        }
    }
    
    async loadWaterPage(container) {
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å –≤–æ–¥—ã –∏–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
            const response = await fetch('water.html');
            const html = await response.text();
            container.innerHTML = html;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º water.js
            const scriptResponse = await fetch('water.js');
            const scriptText = await scriptResponse.text();
            
            // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –≤–æ–¥–Ω–æ–≥–æ —Ç—Ä–µ–∫–µ—Ä–∞
            const script = document.createElement('script');
            script.textContent = `
                // –°–æ–∑–¥–∞–µ–º –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º WaterTracker
                window.waterTracker = new WaterTracker();
                window.waterTracker.init();
                
                // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                window.addWater = function(amount) {
                    if (window.waterTracker) {
                        window.waterTracker.addWater(amount);
                    }
                };
                
                window.removeWater = function(amount) {
                    if (window.waterTracker) {
                        window.waterTracker.removeWater(amount);
                    }
                };
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ water.js
            const originalScript = document.createElement('script');
            originalScript.textContent = scriptText;
            
            document.head.appendChild(originalScript);
            document.head.appendChild(script);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è –≤–æ–¥—ã:', error);
            container.innerHTML = this.getWaterFallback();
        }
    }
    
    getWaterFallback() {
        return `
            <header class="page-header">
                <h1 class="page-title">–í–æ–¥–∞</h1>
                <div class="page-controls">
                    <div class="skin-counter">
                        ‚ú® <span id="skinCount">${this.state.totalSkins}</span>
                    </div>
                    <button class="theme-toggle" onclick="window.healthFlow.toggleTheme()">
                        <div class="theme-icon">üåô</div>
                    </button>
                </div>
            </header>
            
            <div class="content-container">
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;">üíß</div>
                    <h2 style="font-size: 1.5rem; margin-bottom: 10px; color: var(--text-primary);">
                        –ú–æ–¥—É–ª—å –≤–æ–¥—ã
                    </h2>
                    <p style="color: var(--text-secondary); line-height: 1.5;">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥—É–ª—è –≤–æ–¥—ã...
                    </p>
                </div>
            </div>
        `;
    }
    
    async loadWorkoutsPage(container) {
        try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
            const response = await fetch('workouts.html');
            if (!response.ok) throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
            const html = await response.text();
            container.innerHTML = html;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º workouts.js
            const scriptResponse = await fetch('workouts.js');
            const scriptText = await scriptResponse.text();
            
            // –ò—Å–ø–æ–ª–Ω—è–µ–º workouts.js
            const script = document.createElement('script');
            script.textContent = scriptText;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
            script.onload = () => {
                if (window.workoutsManager) {
                    window.workoutsManager.init();
                }
            };
            
            document.head.appendChild(script);
            
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫:', error);
            container.innerHTML = this.getWorkoutsFallback();
        }
    }
    
    getWorkoutsFallback() {
        return `
            <header class="page-header">
                <h1 class="page-title">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h1>
                <div class="page-controls">
                    <div class="skin-counter">
                        ‚ú® <span>${this.state.totalSkins}</span>
                    </div>
                    <button class="theme-toggle" onclick="window.healthFlow.toggleTheme()">
                        <div class="theme-icon">üåô</div>
                    </button>
                </div>
            </header>
            <div class="content-container">
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;">üèãÔ∏è</div>
                    <h2 style="font-size: 1.5rem; margin-bottom: 10px; color: var(--text-primary);">
                        –ú–æ–¥—É–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
                    </h2>
                    <p style="color: var(--text-secondary); line-height: 1.5;">
                        –°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫!
                    </p>
                </div>
            </div>
        `;
    }
    
    loadProfilePage(container) {
        container.innerHTML = `
            <header class="page-header">
                <h1 class="page-title">–ü—Ä–æ—Ñ–∏–ª—å</h1>
                <div class="page-controls">
                    <div class="skin-counter">
                        ‚ú® <span>${this.state.totalSkins}</span>
                    </div>
                    <button class="theme-toggle" onclick="window.healthFlow.toggleTheme()">
                        <div class="theme-icon">üåô</div>
                    </button>
                </div>
            </header>
            <div class="content-container">
                <div style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;">üë§</div>
                    <h2 style="font-size: 1.5rem; margin-bottom: 10px; color: var(--text-primary);">
                        –ü—Ä–æ—Ñ–∏–ª—å
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">
                        –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                    </p>
                    
                    <div style="background: var(--surface); border-radius: var(--radius); padding: 24px; border: 2px solid var(--border-light); margin-bottom: 20px;">
                        <div style="font-size: 3rem; font-weight: 800; color: var(--primary); margin-bottom: 10px;">
                            ${this.state.totalSkins}
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                            –í—Å–µ–≥–æ —Å–∫–∏–Ω—Ç–æ–≤
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
    
    updateNavigation(pageId) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.page === pageId) {
                item.classList.add('active');
            }
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º URL hash
        window.location.hash = pageId;
    }
    
    setupNavigation() {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = item.dataset.page;
                if (pageId && pageId !== this.state.currentPage) {
                    this.loadPage(pageId);
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ hash –≤ URL
        window.addEventListener('hashchange', () => {
            const hash = window.location.hash.substring(1);
            if (hash && hash !== this.state.currentPage && ['water', 'workouts', 'profile'].includes(hash)) {
                this.loadPage(hash);
            }
        });
    }
    
    addSkins(amount, source = 'unknown') {
        const oldSkins = this.state.totalSkins;
        this.state.totalSkins += amount;
        
        console.log(`‚ú® +${amount} —Å–∫–∏–Ω—Ç–æ–≤ (${source}). –í—Å–µ–≥–æ: ${this.state.totalSkins}`);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º
        this.saveState();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        this.updateSkinDisplay();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ —Å–∫–∏–Ω—Ç—ã
        if (amount > 0) {
            this.showNotification(`+${amount} —Å–∫–∏–Ω—Ç–æ–≤ ‚ú®`, 'skins');
        }
        
        return this.state.totalSkins;
    }
    
    updateSkinDisplay() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å—á—ë—Ç—á–∏–∫–∏ —Å–∫–∏–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        document.querySelectorAll('.skin-counter span').forEach(element => {
            element.textContent = this.state.totalSkins;
        });
    }
    
    toggleTheme() {
        this.state.theme = this.state.theme === 'cozy' ? 'light' : 'cozy';
        document.documentElement.setAttribute('data-theme', this.state.theme);
        this.saveState();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫–∏ —Ç–µ–º—ã
        document.querySelectorAll('.theme-icon').forEach(icon => {
            icon.textContent = this.state.theme === 'cozy' ? 'üåô' : '‚òÄÔ∏è';
        });
        
        this.showNotification(`–¢–µ–º–∞: ${this.state.theme === 'cozy' ? '–£—é—Ç–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'}`, 'success');
    }
    
    showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        notification.textContent = message;
        notification.className = `notification show ${type}`;
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }
}

// –°–æ–∑–¥–∞—ë–º –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
window.healthFlow = new HealthFlowApp();

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    window.healthFlow.init();
});
